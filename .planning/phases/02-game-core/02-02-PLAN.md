---
phase: 02-game-core
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/DrillingGrid.tsx
  - components/DrillTile.tsx
  - lib/game-state.ts
  - lib/outcome-logic.ts
  - app/page.tsx
autonomous: true
must_haves:
  truths:
    - "User can see drilling grid with correct size (3x3, 4x4, 5x5)"
    - "Each tile displays its drill cost before being flipped"
    - "User can click individual tiles to drill them one-by-one"
    - "User can click Mine All Tiles to flip all remaining tiles"
    - "Tile outcomes follow spec: Dry Hole 69.84%, Oil Field 24%, Refinery 6%, Motherlode 0.16%"
  artifacts:
    - path: components/DrillingGrid.tsx
      provides: "Grid of tiles"
      contains: "gridSize"
    - path: components/DrillTile.tsx
      provides: "Single tile with cost and outcome"
      contains: "cost"
    - path: lib/outcome-logic.ts
      provides: "Mock outcome selection"
      contains: "Dry Hole"
  key_links:
    - from: components/DrillingGrid.tsx
      to: lib/game-state.ts
      via: "read settings"
      pattern: "useGameState|gameState"
---

<objective>
Build the drilling grid, tile component, and mock outcome logic. Connect to controls; wire Mine All button.

Purpose: GRID-01, GRID-02, GRID-03, GRID-04. Functional game loop with mocked outcomes.
Output: Clickable grid, cost display per tile, outcome resolution.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-game-core/02-01-SUMMARY.md

Tile cost formula (from spec): average A, volatility v. At v=1: min=max(0.01,0.04A), max=min(1000,4A). Generate N costs in [min,max], normalize so sum=N*A. Display each tile's cost before flip.
Outcomes: Dry Hole 69.84% (lose), Oil Field 24% (1.5x), Refinery 6% (4x), Motherlode 0.16% (jackpot).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tile cost generation and outcome logic</name>
  <files>lib/outcome-logic.ts</files>
  <action>
    Create lib/outcome-logic.ts. Function generateTileCosts(gridSize, averageCost, volatility): returns array of N costs. Use formula: min = max(0.01, 0.04*A) when v=1, max = min(1000, 4*A). For v in [0,1] interpolate. Generate random values, normalize so mean = A. Function getOutcome(): weighted random - 69.84% 'dry', 24% 'oil', 6% 'refinery', 0.16% 'motherlode'. Export both.
  </action>
  <verify>Unit test or manual: outcome distribution roughly correct; costs sum to N*A</verify>
  <done>Tile costs and outcomes implement spec</done>
</task>

<task type="auto">
  <name>Task 2: DrillTile and DrillingGrid components</name>
  <files>components/DrillTile.tsx, components/DrillingGrid.tsx</files>
  <action>
    DrillTile: props { cost, outcome?, onDrill, disabled }. Before flip: show cost (e.g. "0.25 SOL"). After flip: show outcome (Dry Hole / Oil Field / Refinery / Motherlode) - simple text or color for now (Phase 3 adds polish). onClick calls onDrill if not flipped. Disabled when flipped.
    DrillingGrid: reads gridSize, averageCost, volatility from game state. On mount/settings change: generate tile costs. Renders grid of DrillTiles. Grid layout: CSS grid, equal square tiles (aspect-square), gap. Track flipped tiles in local state (index -> outcome).
  </action>
  <verify>Grid renders; tiles show cost; clicking flips tile and shows outcome</verify>
  <done>GRID-01, GRID-02, GRID-03 satisfied</done>
</task>

<task type="auto">
  <name>Task 3: Mine All and session state</name>
  <files>components/DrillingGrid.tsx, components/ControlsPanel.tsx, lib/game-state.ts</files>
  <action>
    Add to game state: sessionPnl (number), tilesFlipped (number). When tile drills: deduct cost, add payout (0 for dry, 1.5*cost for oil, 4*cost for refinery, mock jackpot for motherlode), update sessionPnl.
    Mine All button: when clicked, flip all unflipped tiles in one action (loop through and resolve each with getOutcome()). Optionally animate sequentially (fast) or instant. Connect ControlsPanel Mine All to DrillingGrid via callback or state lift.
  </action>
  <verify>Mine All flips all tiles; session P/L updates; balance decrements correctly</verify>
  <done>GRID-04 satisfied; Mine All works</done>
</task>

</tasks>

<verification>
- [ ] npm run build succeeds
- [ ] Grid shows correct size
- [ ] Tiles show cost, click flips to outcome
- [ ] Mine All flips all
- [ ] Session stats update
</verification>

<success_criteria>
- Functional drilling grid with mocked outcomes
- Mine All Tiles works
- Costs and outcomes match spec
</success_criteria>

<output>
After completion, create .planning/phases/02-game-core/02-02-SUMMARY.md
</output>
