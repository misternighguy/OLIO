---
phase: 04-live-features
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - components/ChatPanel.tsx
  - components/GameLayout.tsx
  - app/page.tsx
  - package.json
  - server/ (or real-time provider)
autonomous: true
must_haves:
  truths:
    - "Right panel includes real-time global chat"
    - "User can send messages to chat"
    - "User can see messages from other users in real-time"
  artifacts:
    - path: components/ChatPanel.tsx
      provides: "Real-time chat UI"
      contains: "chat"
  key_links:
    - from: components/ChatPanel.tsx
      to: server or real-time provider
      via: "WebSocket or channel subscription"
      pattern: "socket|realtime|pusher"
---

<objective>
Implement real-time global chat in the right panel. Users send and receive messages live.

Purpose: CHAT-01, CHAT-02, CHAT-03. Social engagement.
Output: ChatPanel component, real-time backend or hosted service.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

From PROJECT: "Real chat (not mocked)" — use Socket.io or a hosted real-time service (Pusher, Ably, Supabase Realtime). MVP has no auth; use anonymous nicknames or "Player #123" for senders.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Real-time backend</name>
  <files>server/, package.json</files>
  <action>
    Choose one: (A) Socket.io — add a minimal Node/Express server (e.g. server/index.js) that runs alongside Next.js, handles socket connections, broadcasts messages to all clients. (B) Pusher or Supabase Realtime — add SDK, create channel, publish/subscribe. For (A): add "socket.io" and "socket.io-client" to package.json; create server that listens on a port (e.g. 3001); add dev script to run both Next.js and server. For (B): add env var for API key; use provider's React hooks or SDK. Document which option is used in README or .env.example.
  </action>
  <verify>Backend accepts connections; broadcasts message to all clients</verify>
  <done>Real-time transport ready</done>
</task>

<task type="auto">
  <name>Task 2: ChatPanel component</name>
  <files>components/ChatPanel.tsx</files>
  <action>
    Create ChatPanel: scrollable message list (flex flex-col, overflow-y-auto), input field + Send button at bottom. Messages show: sender (e.g. "Player #42" or anonymous), text, timestamp (optional). Connect to real-time backend: on mount subscribe to channel; on send emit/publish message. Handle connection states: connecting, connected, error. Dark styling to match stats panel.
  </action>
  <verify>Messages render; sending adds message; other clients receive</verify>
  <done>CHAT-01, CHAT-02, CHAT-03 satisfied</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ChatPanel into layout</name>
  <files>components/GameLayout.tsx, app/page.tsx, components/SessionStats.tsx</files>
  <action>
    Add ChatPanel to right panel below SessionStats. Right panel layout: Stats on top, Chat below (or tabs if space is tight). Ensure both fit in right column (280px) with scrolling for chat. Adjust RightPanel or page structure as needed.
  </action>
  <verify>Right panel shows stats + chat; chat scrolls; layout clean</verify>
  <done>Chat integrated</done>
</task>

</tasks>

<verification>
- [ ] npm run build succeeds
- [ ] Chat sends and receives messages in real-time
- [ ] Open second tab/window; messages appear in both
- [ ] Right panel layout works with stats + chat
</verification>

<success_criteria>
- Real-time chat functional
- Chat integrated into right panel
</success_criteria>

<output>
After completion, create .planning/phases/04-live-features/04-02-SUMMARY.md
</output>
